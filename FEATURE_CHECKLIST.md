* [x] Documentation: write a single developer-facing document describing Linux 5.4 compatibility constraints (no Landlock, no overlayfs-in-userns reliance), the three network modes with strictness caveats, how the bundle works (including inclusion of `agentcli`), how to author policies, and known limitations of rootless operation (optional cgroups only if delegated); DoD: the doc lives in the repo, is linked from `--help`, and contains copy-pastable policy examples and troubleshooting for common kernel settings.
* [x] Bootstrap and preflight (once): ensure a clean workspace and gh auth; run: `git fetch --all --prune && git switch main || git checkout -b main && git pull --ff-only || true && git switch develop && git pull --ff-only && gh auth status`; set repo vars: `REPO=$(git remote get-url --push origin | sed -E 's#.*/([^/]+/[^/]+)(\.git)?$#\1#')`; verify tools: `make -n >/dev/null 2>&1 || true`; Definition of Done: main exists locally and remotely (or created), develop is up to date, gh is authenticated for $REPO.
* [ ] Create a machine-readable PR plan (once): generate docs/PR_PLAN.md enumerating PR order and branch names; sections in this exact order to minimize conflicts: (1) Repo scaffolding & hygiene, (2) Core CLI & client, (3) Tool manifest & runner, (4) Tool-call loop & validator, (5) Baseline docs/ADR/diagrams, (6) Each tool (one PR per tool), (7) Tests per component, (8) Makefile, scripts, and CI gates, (9) Security & runbooks, (10) Research tools (one PR per tool), (11) Remaining docs and examples; commit this plan on a short-lived planning branch: `git switch -c pr/plan && mkdir -p docs && printf "...ordered list with branch names..." > docs/PR_PLAN.md && git add docs/PR_PLAN.md && git commit -m "PR plan: ordered slicing from develop to main" && git push -u origin pr/plan && gh pr create --base main --head pr/plan --title "PR plan: ordered slicing" --body "Adds docs/PR_PLAN.md to drive small PR slicing" --draft`; Definition of Done: a draft PR to main exists containing docs/PR_PLAN.md with the full ordered plan.
* [ ] Slice PR #01 — repo scaffolding (only repo-level files, no code): start from main; `git switch -c pr/01-scaffold main`; restore the minimal set from develop using path-scoped restore: `git restore --source develop --staged --worktree LICENSE README.md .gitignore .gitattributes .editorconfig Makefile go.mod docs/README.md`; ensure Makefile builds without code: `make fmt || true`; commit and push: `git commit -m "Scaffold: LICENSE/README/.gitignore/.gitattributes/.editorconfig/Makefile/go.mod (+ docs index)" && git push -u origin pr/01-scaffold && gh pr create --base main --head pr/01-scaffold --title "Scaffold repository (no code)" --body "Adds legal, docs, Makefile, go.mod; no binaries or code."`; Definition of Done: PR shows only the listed files, CI (if any) passes or is out-of-scope, reviewers can merge without code review complexity.
* [ ] Slice PR #02 — minimal CLI entrypoint (compile-only, no HTTP/tools): `git switch -c pr/02-cli-main main && git restore --source develop --staged --worktree cmd/agentcli/main.go && git restore --source develop --staged --worktree cmd/agentcli/go.* || true && go build ./cmd/agentcli`; update README usage snippet minimally if referenced by main.go; commit/push/create PR; Definition of Done: `go build ./cmd/agentcli` succeeds on a clean checkout of the branch; PR contains only cmd/agentcli/* (and any edited README lines).
* [ ] Slice PR #03 — flags & help (no network): `git switch -c pr/03-flags-help main && git restore --source develop --staged --worktree cmd/agentcli/flags.go cmd/agentcli/usage_test.go docs/reference/cli-reference.md`; run `go test ./cmd/agentcli -run Help -v` (or the repo’s equivalent); commit/push/PR; Definition of Done: `agentcli --help` works locally (prints full usage), tests covering help/flags pass, only flags/help related files changed.
* [ ] Slice PR #04 — OpenAI-compatible HTTP client (types + client, no integration): `git switch -c pr/04-oai-client main && git restore --source develop --staged --worktree internal/oai/types.go internal/oai/client.go internal/oai/*_test.go`; `go test ./internal/oai -run Client -v`; commit/push/PR; Definition of Done: internal/oai unit tests pass and PR contains only internal/oai files (and go.mod/go.sum updates if needed).
* [ ] Slice PR #05 — model defaults & capability map (serialization only): `git switch -c pr/05-model-defaults main && git restore --source develop --staged --worktree internal/oai/capabilities.go internal/oai/capabilities_test.go docs/adr/0004-default-llm-policy.md`; `go test ./internal/oai -run Capabilities`; commit/push/PR; Definition of Done: capability tests green; ADR added; no unrelated changes.
* [ ] Slice PR #06 — tools manifest loader: `git switch -c pr/06-tools-manifest main && git restore --source develop --staged --worktree internal/tools/manifest.go internal/tools/manifest_test.go docs/reference/tools-manifest.md`; `go test ./internal/tools -run Manifest`; commit/push/PR; Definition of Done: manifest tests pass, docs reference added/linked, only manifest-related changes included.
* [ ] Slice PR #07 — secure tool runner (no sandbox yet, argv only): `git switch -c pr/07-tool-runner main && git restore --source develop --staged --worktree internal/tools/runner.go internal/tools/runner_test.go`; `go test ./internal/tools -run Runner`; commit/push/PR; Definition of Done: runner tests pass, env scrub + timeout behavior present, no changes outside internal/tools (except sums).
* [ ] Slice PR #09 — baseline docs & diagrams: `git switch -c pr/09-docs-diagrams main && git restore --source develop --staged --worktree docs/adr/0001-minimal-agent-cli.md docs/diagrams/agentcli-seq.md docs/diagrams/toolbelt-seq.md docs/security/threat-model.md docs/runbooks/troubleshooting.md README.md docs/README.md`; commit/push/PR; Definition of Done: docs render on GitHub (links valid), no code files in PR.
* [ ] Slice PR #10 — example tool get_time + tools.json + Makefile build-tools: `git switch -c pr/10-get-time main && git restore --source develop --staged --worktree tools/cmd/get_time/** tools/bin/.gitkeep tools/testutil/** tools.json Makefile README.md`; `make build-tools && ./tools/bin/get_time <<< '{"tz":"Europe/Helsinki"}'`; commit/push/PR; Definition of Done: get_time builds and runs, tools.json declares it with schema, Makefile emits tools/bin/get_time(.exe), only these paths changed.
* [ ] Slice PR #11 — quickstart README runnable: `git switch -c pr/11-quickstart main && git restore --source develop --staged --worktree README.md`; validate the quickstart end-to-end against current feature set; commit/push/PR; Definition of Done: quickstart commands copy-paste cleanly on a fresh clone for current branch scope.
* [ ] Slice PR #12 — minimal unit tests enabling (core only): `git switch -c pr/12-core-tests main && git restore --source develop --staged --worktree internal/oai/*_test.go internal/tools/*_test.go cmd/agentcli/*_test.go`; `go test ./...`; commit/push/PR; Definition of Done: tests that rely only on already-merged features pass; tests requiring future tools remain excluded.
* [ ] Slice each tool as its own PR (repeat this item once per tool, substituting NAME and the exact file set): `git switch -c pr/tool-NAME main && git restore --source develop --staged --worktree tools/cmd/NAME/** && git restore --source develop --staged --worktree docs/reference/NAME.md || true && jq '.tools[]|select(.name=="NAME")' tools.json >/dev/null 2>&1 || git restore --source develop --staged --worktree tools.json && make build-tools NAME=NAME && go test ./tools/cmd/NAME -run . && git commit -m "tool(NAME): add tool implementation, schema, tests, docs" && git push -u origin pr/tool-NAME && gh pr create --base main --head pr/tool-NAME --title "Tool: NAME" --body "Adds tools/cmd/NAME (+ tests), wires tools/bin/NAME in Makefile, updates tools.json, and adds docs/reference/NAME.md; contract: stdin/out + stderr JSON on error; includes examples and runbook notes."`; Definition of Done: branch builds `tools/bin/NAME(.exe)`, the tool’s focused tests pass, tools.json entry valid, docs page present; PR contains only NAME and the touched manifest/Makefile/docs; examples: get_time (already done), exec, fs_read_file, fs_write_file, fs_append_file, fs_rm, fs_move, fs_search, fs_mkdirp, fs_apply_patch, fs_read_lines, fs_edit_range, fs_listdir, fs_stat, img_create, http_fetch, searxng_search, robots_check, readability_extract, metadata_extract, pdf_extract, rss_fetch, wayback_lookup, wiki_query, openalex_search, crossref_search, github_search, dedupe_rank, citation_pack.
* [ ] Slice PR — tool error-contract standardization (one tool per PR for clarity): for each tool that needs the unified stderr JSON `{"error":"...","hint?":"..."}` behavior, branch from main, restore only that tool’s sources and tests from develop, run its negative-path tests, fix if needed, commit and PR titled `Tool NAME: standardize error contract`; Definition of Done: tool emits single-line stderr JSON on failure and exits non-zero, tests cover it, PR only touches that tool.
* [ ] Slice PR — Makefile wiring (TOOLS list, build-tools/clean, Windows .exe): `git switch -c pr/makefile-tools main && git restore --source develop --staged --worktree Makefile && make build-tools && make clean`; commit/push/PR; Definition of Done: `make build-tools` deterministically builds all already-merged tools to tools/bin, `make clean` removes them, no code beyond Makefile changed.
* [ ] Slice PR — scripts and gh utilities (no external deps beyond gh): `git switch -c pr/scripts main && git restore --source develop --staged --worktree scripts/**/* .github/** || true`; keep only scripts that don’t assume features not yet merged; `bash -n scripts/*.sh || true`; commit/push/PR; Definition of Done: scripts shellcheck clean (if configured) and runnable where applicable; PR limited to scripts/ and CI YAML.
* [ ] Slice PR — security & runbooks: `git switch -c pr/security-runbooks main && git restore --source develop --staged --worktree docs/security/** docs/runbooks/** README.md`; commit/push/PR; Definition of Done: security posture and troubleshooting render with valid links, no code in PR.
* [ ] Slice PR — ADRs (one ADR per PR unless trivial): for each ADR file under docs/adr not yet in main, `git switch -c pr/adr-XXXX main && git restore --source develop --staged --worktree docs/adr/XXXX-*.md docs/README.md README.md && git commit -m "ADR-XXXX: <title>" && git push && gh pr create ...`; Definition of Done: ADR renders, is linked from docs index and README, no code changes.
* [ ] Slice PR — diagrams (grouped if tightly related): `git switch -c pr/diagrams main && git restore --source develop --staged --worktree docs/diagrams/** README.md docs/README.md`; verify GitHub renders Mermaid; commit/push/PR; Definition of Done: diagrams render and links valid; no code files.
* [ ] Slice PR — CLI features: group the smallest cohesive increments (each as its own PR): (a) `--version`, (b) `--print-config`, (c) split http vs tool timeouts + retries/backoff, (d) length backoff + `max_tokens`, (e) message-sequence validator in pre-stage, (f) pre-stage enable/disable + flags; for each: new branch from main, restore only the minimal necessary files (cmd/agentcli/* + internal where needed + docs/tests), run `go test ./...`, commit/push/PR with focused title/body; Definition of Done: each PR compiles, has passing tests for the feature, and touches only the minimal feature scope.
* [ ] Slice PR — parallel tool calls (main loop) isolated: `git switch -c pr/parallel-tool-calls main && git restore --source develop --staged --worktree cmd/agentcli/*parallel* internal/*/validator* cmd/agentcli/*_test.go`; run the concurrency test; commit/push/PR; Definition of Done: tests proving concurrency semantics pass; PR limited to loop/validator/tests.
* [ ] Slice PR — audit logs and redaction (internal/tools runner + client): create two PRs: (1) HTTP timings/audit fields; (2) tool runner audit + redaction; for each: branch, restore minimal internal files + tests + docs/runbooks update, run tests, commit/push/PR; Definition of Done: NDJSON log lines present with expected fields, tests assert structure, docs mention redaction.
* [ ] Slice PR — research toolbelt (one PR per research tool): repeat the per-tool PR item for searxng_search, http_fetch, robots_check, readability_extract, metadata_extract, pdf_extract, rss_fetch, wayback_lookup, wiki_query, openalex_search, crossref_search, github_search, dedupe_rank, citation_pack, each including its doc page and tools.json entry, with SSRF guards and retries as already implemented in develop; Definition of Done: each PR builds its tool, tests green offline with httptest.Server fixtures, docs reference added; no coupling between tools across PRs.
* [ ] Slice PR — integration tests (minimal end-to-end): branch from main and add only the smallest deterministic integration test that exercises one already-merged tool (e.g., fs_write_file→fs_read_file) using a fake API; `git restore --source develop --staged --worktree cmd/agentcli/tools_integration_test.go tools/testutil/**`; run `go test ./cmd/agentcli -run AdvertisesSchemas`; commit/push/PR; Definition of Done: integration passes locally, PR contains only integration test files and helpers.
* [ ] Slice PR — README finalization and examples (grouped): branch, restore examples/ that match only merged tools, update README links; commit/push/PR; Definition of Done: examples run locally without network (or with documented mock), links valid.
* [ ] For every PR above, enforce the same PR hygiene (apply each time): before commit, run `go mod tidy && make fmt && make build && make build-tools && go test ./... && make lint || true` (keep gates as available on local machine); ensure commit message starts with a clear scope (`scaffold:`, `cli:`, `oai:`, `tool(NAME):`, `docs:`), and the PR body includes a short rationale, the contract (if a tool/API), and a verification section; create the PR with `gh pr create --base main --head <branch> --title "<scope>: <summary>" --body-file <auto-generated body> --draft` if any gate not yet green, otherwise without `--draft`; Definition of Done: PR shows only the intended diff (verify with `git diff --name-only origin/main...HEAD`), local tests for its scope are green, title/body meet reviewability standards.
* [ ] Post-migration cleanup (final PR): when all features are merged, remove docs/PR_PLAN.md (or mark as historical), ensure tools/bin/* are gitignored only (no binaries tracked), run a last `make clean && make build build-tools && go test ./... && make lint`; commit any final doc link fixes; Definition of Done: main contains the full feature set, no legacy artifacts remain, and local gates pass end-to-end.
* [ ] Merge discipline and sequencing (applies continuously): once a PR is approved and CI (if present) is green, merge with “squash and merge” to keep history clean; after merge, `git switch main && git pull --ff-only && git branch -D <feature-branch> || true`; before opening the next PR, re-create branches from updated main; Definition of Done: main advances one minimal feature at a time, no open PR depends on another unmerged PR (or if unavoidable, clearly state `--base <dependent-branch>` and retarget to main immediately after the base merges).
