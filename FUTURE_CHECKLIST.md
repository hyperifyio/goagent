* [x] Ensure `check-go-version` is enforced in CI and locally by wiring it into `make lint`. Smallest change: prepend `$(MAKE) check-go-version` in the `lint` recipe before any linter runs. DoD: `make lint` fails fast on version drift (manual test by temporarily exporting an older/newer Go on a dev machine), passes otherwise; CI shows the check executed before golangci-lint; all gates green; peer review completed.
      - [x] [S02a1c0:l252-ci-push-preflight-blocked] Preflight on this headless runner indicates GitHub authentication is missing. Next step: on a browser-capable host run `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --device`, verify `ssh -T git@github.com` greets successfully, then execute `scripts/ci_push_pr.sh`. Capture the PR and CI run URLs and verify lint logs show `check-go-version: OK` before `golangci-lint version` across the matrix.
    - [x] [S02u0a1b:l252-gh-device-login-blocked] Preflight on this runner shows `gh auth status` invalid token, `git_protocol=ssh`, `ssh -T git@github.com` fails with publickey, and `GH_TOKEN` absent. Next: on a machine with a browser, run `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --device`, complete the device flow, then re-run `gh auth status -h github.com` and proceed to add the SSH key.
    - [x] [S02u0a1c0:l252-gh-device-login-web-preflight] Verified local gates are green (go test, make lint), `gh auth status -h github.com` reports invalid/absent token and `gh config get -h github.com git_protocol` is `ssh`; blocked awaiting browser-based device flow on a capable host. Next: perform the device-flow login on a browser host per S02u0a1c, then return to verify and proceed to add the SSH key.
    - [x] [S02a1b0:l252-ci-green-auth-blocked-preflight] Local gates green (go test, make lint); authentication remains absent on this headless host. Recorded BLOCKED state and next step in `logs/coding.log` and `logs/gh_auth_status.*`. Next: complete device-flow login on a browser-capable machine, add SSH key, verify `ssh -T git@github.com`, then push branch and open PR to trigger CI.
    - [x] [S02u1:l252-ssh-keygen] Generate an SSH key pair and surface the public key for account enrollment; DoD: `~/.ssh/id_ed25519.pub` exists, fingerprint recorded in `logs/coding.log`, and instructions included to add the key via GitHub Web or `gh ssh-key add` so a subsequent `ssh -T git@github.com` can succeed.
  - [x] [S11:l252-ci-skeleton-file] Create `.github/workflows/ci.yml` (new) containing a single job `lint-test-build` with a step named exactly `lint (includes check-go-version)` that runs `make tidy && make lint | tee lint.log` and a subsequent step named exactly `Assert lint order (check-go-version before golangci-lint)` that compares line numbers of `^check-go-version: OK` and `^golangci-lint version` in `lint.log` (fail if absent or out of order); DoD: `go test ./internal/ci -run TestLintOrderLocallyAndInWorkflow` passes locally reading the workflow file and finding both expected step names.
  - [x] [S12:l252-ci-matrix-gover] Expand the workflow to a matrix over `{ubuntu-latest, macos-latest, windows-latest}` and use `actions/setup-go@v5` with `go-version-file: go.mod` in the `lint-test-build` job; DoD: workflow syntax validates, unit test still passes, and a PR run shows the same Go major.minor across OSes in logs.
  - [x] [S13:l252-windows-install-rg] Add a Windows-only step before lint to install ripgrep (e.g., `choco install ripgrep -y`) so `make lint`’s `check-tools-paths`/`verify-manifest-paths` do not fail due to `ensure-rg`’s Linux/macOS-only installer; DoD: on `windows-latest`, the `lint (includes check-go-version)` step completes and finds `rg` on PATH.
  - [x] [S14:l252-windows-shell-bash] For `windows-latest`, force GNU bash for all `run` steps that invoke `make` (set `defaults.run.shell: bash` at the job level or `shell: bash` per step) to satisfy Makefile’s bashisms and `SHELL := /bin/bash`; DoD: Windows lint step executes successfully without PowerShell/`/bin/sh` path errors, and the unit test remains green.
* [x] Add `make lint-precheck` to fail fast on analyzer/export-data mismatches. Smallest change: implement a shell precheck used by `lint` that (1) validates `$(GOBIN)/golangci-lint` exists, (2) extracts `GCL=$$($(GOBIN)/golangci-lint version | sed -nE 's/.*version ([v0-9\\.]+).*/\\1/p')`, (3) compares against `MIN=v1.60.0` using `sort -V`, and (4) prints an explicit hint if too old: “golangci-lint $GCL < $MIN with Go \$\$(go version)… update GOLANGCI\_LINT\_VERSION”. DoD: with a forced older version, `make lint` fails before analysis with the hint; with the pinned version, it proceeds; CI green; peer review completed.
* [ ] Strengthen the Makefile test target to run go test -race -cover ./... and write a coverage profile under bin/coverage.out so local testing matches planned CI gates, smallest change is editing the Makefile test recipe only; scope Makefile; low risk; DoD includes running make test from a clean clone succeeds with race detector enabled and coverage file produced, tests otherwise unchanged and green with no coverage regression, all quality gates green with no new findings, peer review completed, verification by observing race-enabled run and generated coverage file, rollback by reverting the Makefile edit.
* [ ] Switch submodule URLs in .gitmodules from SSH to HTTPS to simplify CI clones without SSH keys (public submodules .cursor/rules and scripts), smallest change is editing .gitmodules and running git submodule sync; scope repository hygiene; low risk; DoD includes actions/checkout with submodules enabled succeeding in a new CI workflow, tests unchanged and green with no coverage regression, all quality gates green, peer review completed, verification by observing CI clone success without extra SSH setup and local git submodule update --init works, rollback by reverting the .gitmodules change and syncing.
* [ ] Add a make vuln target that installs and runs govulncheck ./... and wire it into CI after unit tests to fail builds on known vulnerabilities, smallest change is adding the target in the Makefile and a CI step once workflows exist; scope security scanning; low risk; DoD includes make vuln passing locally on a clean tree, CI green with the new step and no new findings, tests unchanged and green with no coverage regression, all gates green, peer review completed, verification by introducing a known vulnerable transient dependency in a branch to see CI fail then removing it restores green, rollback by reverting the Makefile and CI edits.
* [ ] Add secret detection with gitleaks via a make secrets target and a CI step using the official action with a minimal .gitleaks.toml allowlist to reduce false positives, smallest change is adding the config, target and CI step; scope security hygiene; low risk; DoD includes make secrets passing locally on a clean tree, CI green with no new leaks, tests unchanged and green with no coverage regression, all gates green, peer review completed, verification by committing a fake test secret in a branch to observe CI fail then removing it restores green, rollback by reverting the config and CI step.
* [ ] Standardize all Bash scripts under scripts to use env bash shebang and strict mode set -euo pipefail and add a make shellcheck target with a minimal configuration plus a CI step to run it, because several scripts currently lack pipefail or only set -u which weakens detection of failures; smallest change is editing script headers, adding one Makefile target, and a short workflow step; scope scripts, Makefile, CI; low risk; DoD includes an initial failing run then passing with zero shellcheck warnings, tests unchanged and green with no coverage regression, all quality gates green, peer review completed, verification by running shellcheck locally and observing CI green, rollback by reverting the script, Makefile, and workflow edits.
* [ ] CI smoke job for tools — workflow builds tools, runs each binary with sample stdin, and runs an agent loop against a fake API; no external network dependence; DoD: green in PRs, artifacts attached, linked to issue.
* [ ] Add GitHub CodeQL code scanning for Go by committing .github/workflows/codeql.yml using the official CodeQL action with default queries on push and pull_request so security analysis runs automatically; evidence: no CodeQL workflow exists today; scope .github/workflows only; low risk and independent; DoD: CodeQL job runs green with zero new alerts, tests unchanged and green with no coverage regression, all quality gates green (vet, gofmt, golangci-lint, staticcheck, security and secret detection) with no new findings, peer review completed; verify by viewing the Security > Code scanning alerts page and the workflow run logs; rollback by deleting the workflow file.
* [ ] Document the release process in docs/releasing.md including tagging artifact naming checksums and verification and rollback guidance aligned with the planned release workflow, smallest change is a single page and links from README and the future release workflow, scope documentation, low risk, DoD includes dry run steps validated locally without publishing tests unchanged and green all quality gates green peer review completed verification by executing the documented commands in dry run rollback by removing the doc and links, traceability https://github.com/hyperifyio/goagent/issues/214.
* [ ] Add release workflow for static binaries and checksums: `.github/workflows/release.yml` triggered on tags like `v*`; build `agentcli` for `linux,darwin,windows` × `amd64,arm64` with `CGO_ENABLED=0`; name outputs `agentcli_<os>_<arch>` (Windows `.exe`); generate `SHA256SUMS` and `SHA256SUMS.sig` (optional GPG); create GitHub Release and upload artifacts and checksums; document in README how to download and verify.
* [ ] Add a make sbom target that uses syft (or cyclonedx-gomod as a fallback if syft is unavailable) to produce a CycloneDX SBOM at reports/sbom.json from the current module and wire it into the release workflow to upload as an asset, because the repo currently lacks an SBOM which weakens supply-chain visibility; smallest change is adding one Makefile target and a short CI step with a docs sentence; scope Makefile and CI; low risk; DoD includes failing first when the tool is missing then passing with deterministic output on a clean clone, tests unchanged and green with no coverage regression, all quality gates green (vet, format, golangci-lint, static analysis, security and secret scans) with no new findings, backward compatibility preserved, peer review completed, verification by running make sbom locally and seeing reports/sbom.json and by confirming the asset on a tagged release, rollback by reverting the Makefile and workflow edits.
* [ ] Tag and publish `v0.1.0` once CI is green and docs/tests are complete: ensure `README.md` has usage, examples, and limitations (no streaming, sequential tool calls only); ADR-0001 and sequence diagram present; unit and integration tests passing; create annotated tag `git tag -a v0.1.0 -m "MVP non-interactive agent CLI with OpenAI-compatible tools"` and `git push --tags`.
* [ ] Add GitHub Dependabot at .github/dependabot.yml to update Go modules weekly and GitHub Actions monthly so dependencies and CI actions stay current with minimal noise; smallest change is committing a single dependabot.yml file; scope repository hygiene; low risk and independent; DoD includes Dependabot PRs opening on schedule with passing CI and no coverage regression, all quality gates green (vet, format, lint, security and secret detection) with no new findings, peer review completed; verification by observing the first PRs or running a local preview, rollback by removing the configuration file.
* [ ] Add CODEOWNERS at .github/CODEOWNERS to automatically request reviews from maintainers; smallest change is committing one CODEOWNERS file mapping paths to the maintainers team; scope repository hygiene; low risk; DoD includes PRs auto-requesting reviews from owners, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by opening a test pull request and observing requested reviewers; rollback by removing the CODEOWNERS file.
* [ ] Add SECURITY.md under .github with a concise vulnerability disclosure policy including contact, supported versions, and response expectations, and link it from README; smallest change is a single Markdown file and one README sentence; scope security documentation; low risk; DoD includes the GitHub Security tab surfacing the policy, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by visiting the repository Security page, rollback by removing the file and README link.
* [ ] Add pull request template at .github/PULL_REQUEST_TEMPLATE.md prompting for canonical issue URL, intent, Definition of Done checklist, and test plan; smallest change is committing one template file; scope contribution workflow; low risk; DoD includes new pull requests prefilled with the template, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by opening a draft pull request and seeing the template, rollback by removing the template file.
* [ ] Add issue templates at .github/ISSUE_TEMPLATE/bug_report.yml and .github/ISSUE_TEMPLATE/feature_request.yml plus config.yml to disable blank issues; smallest change is committing two minimal YAML templates and one config; scope issue hygiene; low risk; DoD includes the New issue page showing the templates with required fields, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by clicking New issue and observing the choices, rollback by removing the templates.
* [ ] Add GitHub CodeQL code scanning for Go by committing .github/workflows/codeql.yml using the official CodeQL action with default queries on push and pull_request so security analysis runs automatically; evidence: no CodeQL workflow exists today; scope .github/workflows only; low risk and independent; DoD: CodeQL job runs green with zero new alerts, tests unchanged and green with no coverage regression, all quality gates green (vet, gofmt, golangci-lint, staticcheck, security and secret detection) with no new findings, peer review completed; verify by viewing the Security > Code scanning alerts page and the workflow run logs; rollback by deleting the workflow file.
* [ ] Add jq to README Installation prerequisites with OS-specific install snippets (apt, brew, choco) because README examples and runbooks pipe tool output to jq but prerequisites omit it; smallest change is editing README only; scope documentation; low risk and independent; DoD: README renders correctly on GitHub, examples run from a clean clone with jq installed, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by executing one README example end-to-end with jq and observing the pretty-printed JSON; rollback by reverting the README edit.
* [ ] Upload coverage profile and summary in CI by attaching bin/coverage.out as an artifact and printing total coverage using go tool cover func; smallest change is adding two steps in .github/workflows/ci.yml after the test step; scope CI; low risk; depends on the Makefile test target producing a coverage profile as already planned; DoD includes CI artifacts containing coverage.out and logs showing total coverage percentage, tests otherwise unchanged and green with no coverage regression, all quality gates green, peer review completed; verify by inspecting CI artifacts and logs, rollback by removing the new steps.
    - [ ] [S02a1b:l252-ci-green-auth-blocked] Blocked in this headless environment without GitHub authentication; next step: on a browser-capable machine complete `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --device` (or export `GH_TOKEN` with `admin:public_key`), add the SSH public key, verify `ssh -T git@github.com` greets, then run `git push --set-upstream origin s02-l252-ci-green` and `gh pr create` to trigger CI and capture the run URL.
    - [ ] [S02u0:l252-auth-and-push] Blocked locally without GitHub auth: authenticate (device flow or `GH_TOKEN` with `admin:public_key`), add the existing SSH public key via `gh ssh-key add ~/.ssh/id_ed25519.pub -t goagent-ci`, then set upstream and push this branch to open a PR and trigger CI.
Blocked: SSH handshake fails with "Permission denied (publickey)"; next step is to configure GitHub authentication (add SSH key or run gh auth login with write access), then push this branch and open a PR to trigger CI and capture the run URL for verification.
Next: authenticate the GitHub CLI for github.com using device flow with SSH protocol and admin:public_key scope, add the existing SSH public key to the account, verify ssh -T git@github.com succeeds, then push the branch and open a PR to trigger CI.
  - [ ] [S02:l252-ci-green] Verify in CI that the Lint job executes check-go-version first and passes on runners matching go.mod; next step: run CI and confirm logs.
    - [ ] [S02a1:l252-ci-green-auth-and-push] Authenticate with GitHub (device flow or GH_TOKEN with admin:public_key), verify `ssh -T git@github.com` greets, then push this branch and open a PR to trigger CI; DoD: capture the run URL and confirm lint logs show "check-go-version: OK" before "golangci-lint version" across the matrix.
    - [ ] [S02a1c:l252-ci-green-push-script] After authentication on a browser-capable host, run `scripts/ci_push_pr.sh` to push `s02-l252-ci-green` and open a PR; capture the run URL and verify lint logs show `check-go-version: OK` before `golangci-lint version` across the matrix.
  - [ ] [S02u0a:l252-gh-device-flow] Authenticate GitHub CLI using device flow with SSH protocol and admin:public_key scope, add the existing SSH public key to the account, verify ssh -T git@github.com greets successfully, then push the branch and open a pull request to trigger CI.
    - [ ] [S02u0a1:l252-gh-device-login] Start device flow login with SSH protocol and required scope: `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --device`; upon success, proceed to add the SSH key and verify handshake.
    - [ ] [S02u0a1c:l252-gh-device-login-web] On a browser-capable host, complete GitHub CLI device flow login for github.com using SSH protocol and admin:public_key scope, then return here to verify authentication and proceed to add the SSH key.
         - [ ] [S02u2b1a:l252-gh-login-blocked] Current state: `gh auth status` reports invalid/absent token and `GH_TOKEN` is not exported in this environment. Next: run device flow `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --device` (or export `GH_TOKEN` with `admin:public_key` and rerun the token login), then verify `gh auth status -h github.com` exits 0 and `gh config get -h github.com git_protocol` prints `ssh`.
  - [ ] [S02u:l252-gh-auth] Configure GitHub authentication for this environment (SSH key or `gh auth login`) and set upstream for `s02-l252-ci-green`; DoD: `git push --set-upstream origin s02-l252-ci-green` succeeds and `gh pr create` opens a PR to trigger CI.
    - [ ] [S02u2:l252-ssh-enroll] Enroll the public key in GitHub and verify handshake; DoD: `gh ssh-key add ~/.ssh/id_ed25519.pub -t goagent-ci` (or GitHub Settings) and `ssh -T git@github.com` prints the success greeting.
      - [ ] [S02u2a:l252-ssh-enroll-gh-cli] If web UI is unavailable, set `GH_TOKEN` for your account and run `gh ssh-key add ~/.ssh/id_ed25519.pub -t goagent-ci`; then verify with `ssh -T git@github.com` that the success greeting is printed.
        - [ ] [S02u2a1:l252-gh-token-export] Obtain a GitHub token with `admin:public_key` scope and export it as `GH_TOKEN`, then rerun `gh ssh-key add ~/.ssh/id_ed25519.pub -t goagent-ci` and confirm `ssh -T git@github.com` prints the success greeting; DoD: `gh ssh-key add` exits 0 and `ssh -T` greets the user.
      - [ ] [S02u2b:l252-gh-auth-status] After enrollment, run `gh auth status -h github.com` and ensure it reports a logged-in state and `git_protocol: ssh`; then proceed to push and open a PR.
        - [ ] [S02u2b1:l252-gh-login-ssh] Authenticate GitHub CLI for `github.com` with SSH protocol using a non-interactive token if available: `printf "$GH_TOKEN\n" | gh auth login -h github.com --git-protocol ssh --with-token` (or `gh auth login -h github.com --git-protocol ssh --web` if interactive); DoD: `gh auth status -h github.com` exits 0 and `gh config get -h github.com git_protocol` prints `ssh`.
        - [ ] [S02u2a2:l252-gh-scope-refresh] If an exported `GH_TOKEN` is not available, authenticate and grant the required scope using the GitHub CLI device flow, then proceed to add the SSH key: `gh auth login -h github.com --git-protocol ssh --scopes admin:public_key --web` (or `--device`), or run `gh auth refresh -h github.com -s admin:public_key` to extend an existing login; then execute `gh ssh-key add ~/.ssh/id_ed25519.pub -t goagent-ci` and verify `ssh -T git@github.com` prints the success greeting. DoD: `gh auth status` shows `admin:public_key` scope, `gh ssh-key add` exits 0, and `ssh -T` greets the user.
  - [ ] [S02c:l252-open-pr] Open a PR for this branch to trigger CI on all OSes; after the run, capture the workflow URL and verify `check-go-version: OK` appears before `golangci-lint` output in the lint step across the matrix; then proceed to mark S02 done.
  - [ ] [S02a:l252-run-ci] Trigger CI by pushing this branch or opening a PR to run the workflow; confirm logs show `check-go-version` output before `golangci-lint` and that the step passes on runners matching `go.mod`; record the CI run URL in the PR/issue, then mark S02 complete.
  - [ ] [S10:l252-traceability-link] When opening the CI-verification PR, include the CI run URL and note that ordering was verified; DoD: PR description updated; no code changes.
* [ ] Document and operationalize the specific failure mode you hit: “golangci-lint: unsupported export data (internal/goarch version: 2)”. Smallest change: add a subsection to `docs/runbooks/troubleshooting.md` and `docs/operations/ci-quality-gates.md` titled exactly that with symptoms, cause (Go/golangci-lint mismatch), and the resolution steps: run `make check-go-version`, ensure ADR-0003 policy, run `make install-golangci`, rerun `make lint`. DoD: docs render on GitHub, steps verified, CI green, peer review completed.
* [ ] (Contingency, removable later) Add a temporary CI lint job that runs with Go 1.23.x if the pinned linter still fails on 1.24.x; tests and build jobs stay on `go-version-file: go.mod`. Smallest change: duplicate the `lint` job as `lint-compat`, set `actions/setup-go@v5` `go-version: "1.23.x"`, run `make lint`, mark with a TODO comment referencing the issue to remove once ADR-0003 policy is fully green with 1.24.x. DoD: CI green with both lint jobs; issue description captures the intent to delete this path; peer review completed; rollback by deleting the `lint-compat` job.
* [ ] Add a one-shot verifier in CI that prints versions for traceability. Smallest change: in the `lint` job, after setup and install, run `go version && $(GOBIN)/golangci-lint version` and emit them as step outputs (name the step “toolchain-versions”); no functional changes. DoD: CI logs show versions on all OSes; no gate regressions; peer review completed.
* [x] Add Windows/macOS/Linux path tests for `save.dir` correctness and SHA-256 reporting (use `tools/testutil/MakeRepoRelTempDir`), and verify image bytes are identical to decoded b64; DoD: platform-agnostic tests green across CI matrix.
  - [x] [S11:adr-0006-file] Create `docs/adr/0006-image-generation-tool-img_create.md` documenting `img_create` (Context/Decision/Consequences) with explicit links to `tools/cmd/img_create/img_create.go`, `docs/reference/img_create.md`, `internal/tools/manifest.go`, `internal/tools/runner.go`, and `docs/diagrams/toolbelt-seq.md`; include security/envPassthrough and transcript‑hygiene rationale; DoD: file renders on GitHub and all relative links resolve.
  - [x] [S12:docs-index-adr-0006] Add ADR‑0006 entry to `docs/README.md` under ADRs with link `adr/0006-image-generation-tool-img_create.md`; DoD: link clickable and resolves in GitHub UI.
  - [ ] [S13:readme-adr-0006-link] In root `README.md` “Documentation” section, add an ADR‑0006 bullet linking to `docs/adr/0006-image-generation-tool-img_create.md`; DoD: link renders and resolves.
  - [ ] [S14:adr-0004-see-also-0006] At the top of `docs/adr/0004-default-llm-policy.md`, add “See also: ADR‑0006” linking to `0006-image-generation-tool-img_create.md`; DoD: link resolves; no other content changes.
  - [ ] [S15:adr-0005-see-also-0006] In `docs/adr/0005-harmony-pre-processing-and-channel-aware-output.md`, add a “See also: ADR‑0006” cross‑link near the Related policy section; DoD: link resolves and formatting preserved.
  - [ ] [S16:cli-reference-adr-0006-xref] In `docs/reference/cli-reference.md`, add a one‑line cross‑link to `../adr/0006-image-generation-tool-img_create.md` next to the `-capabilities` output description; DoD: link resolves; headings intact.
  - [ ] [S17:img-create-ref-xref] At the top of `docs/reference/img_create.md`, insert a short “See ADR‑0006” link to `../adr/0006-image-generation-tool-img_create.md`; DoD: link resolves and doc structure unchanged.
  - [ ] [S18:verify-docs-ci-0006] Run `go test ./...` and `make lint`; verify ADR‑0006 links render and resolve via GitHub preview; DoD: tests/lint green and all links verified.
  - [ ] [S19:update-diagrams-xref] Ensure `docs/diagrams/toolbelt-seq.md` is referenced from ADR‑0006 and confirm `README.md` Diagrams section continues to include `docs/diagrams/toolbelt-seq.md`; DoD: ADR‑0006 contains the diagram link and README retains the entry.

## Review 2025-08-17
* [ ] Fix errcheck warnings by handling or asserting error returns in tests currently flagged by golangci-lint (e.g., internal/oai/client_test.go writes and cmd/agentcli/main_test.go json Encode/Setenv/Unsetenv), smallest change is editing only those tests to check errors or add narrowly justified nolint comments, scope lint hygiene (tests only), low risk, DoD includes `make lint` passing with errcheck clean and tests unchanged and green with no coverage regression, all quality gates green, peer review completed, verification by running `make lint` and observing no errcheck diagnostics in those files, rollback by reverting the test edits.
* [ ] Remove the inadvertently committed root-level `agentcli` binary and prevent reintroduction by adding `agentcli` (and Windows `agentcli.exe`) to `.gitignore`; smallest change is `git rm agentcli` and appending two ignore entries; scope repository hygiene; low risk; DoD includes `git ls-files --error-unmatch agentcli` failing, `make build` producing `bin/agentcli` as documented, `git status` clean after builds across OSes, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verification by running those commands; rollback by reverting the `.gitignore` edit and restoring the file if necessary.
* [ ] Remove tracked lint artifacts `lint.err` and `lint_verify.err` and add ignore entries for them in `.gitignore` to keep the working tree clean after lint runs; smallest change is `git rm` those files and append two ignore lines; scope repository hygiene; low risk; DoD includes `git status` clean after `make lint`, tests unchanged and green with no coverage regression, all quality gates green, peer review completed; verification by running `make lint` and observing no new tracked `*.err` files; rollback by reverting the `.gitignore` edit and re-adding the files if required.
* [ ] Fix README CI badge that links to a non-existent Actions workflow by temporarily removing the badge line pointing to actions/workflows/ci.yml until a real workflow exists; scope documentation only; low risk and independent; DoD includes README rendering without a broken image link, tests unchanged and green with no coverage regression, all quality gates green, one peer review completed; verify by viewing the README on GitHub and confirming no broken badge; rollback by restoring the badge once the workflow is added.

## Review 2025-08-18
* [ ] Fix errcheck warnings in production code by handling or asserting error returns currently flagged in non-test packages (e.g., cmd/agentcli/main.go writePrepCache calls, internal/oai/client.go resp.Body.Close/io.ReadAll, tools/cmd/img_create/*.go Encode/Close/Remove); smallest change is adding error checks or narrowly justified ignores where safe; scope limited to non-test packages and tool binaries; low risk and independent; DoD includes make lint passing with no errcheck diagnostics in these files, tests unchanged and green with no coverage regression, all quality gates green; verify by running make lint and confirming errcheck clean; rollback by reverting the edits.
* [ ] Reduce cyclomatic complexity of tools/cmd/img_create/img_create.go function run (gocyclo=54) by extracting small helpers for input parse/validate, API request/response handling, file writes, and stdout JSON; no behavior change; scope single tool; low–moderate effort; DoD includes golangci-lint gocyclo no longer flagging run (>20), make lint and tests passing, coverage unchanged, peer review completed; verify via golangci-lint output and go test; rollback by reverting the refactor.
* [ ] Reduce cyclomatic complexity of internal/tools/runner.RunToolWithJSON (gocyclo=21) by extracting environment construction and process execution into focused helpers without changing semantics; scope internal/tools only; low effort and independent; DoD includes golangci-lint gocyclo clean for this function, make lint and tests passing, coverage unchanged; verify via golangci-lint and go test; rollback by reverting the refactor.
* [ ] Remove the staticcheck SA9003 empty branch in cmd/agentcli/main.go around the pre-stage block (~line 673) by deleting the no-op branch or consolidating logic; scope single file; low risk and independent; DoD includes make lint passing with no SA9003 warning, tests green with no coverage regression, all quality gates green; verify by rerunning make lint and confirming staticcheck clean; rollback by reverting the line-level change.
* [ ] Ignore editor swap files and remove the stray .FEATURE_CHECKLIST.md.swp: append a *.swp entry to .gitignore (minimal change) and delete the existing file; scope repository hygiene; low risk and independent; DoD includes git status clean after editing with Vim (no new tracked *.swp), git ls-files --error-unmatch .FEATURE_CHECKLIST.md.swp fails, tests and lint unchanged and green with no coverage regression, all quality gates green; verify by creating and saving a file in Vim and observing no tracked swap file; rollback by reverting the .gitignore edit and restoring the file if necessary.
* [ ] Correct the README fs_search example to match the tool schema: replace invalid keys (path, pattern, glob, caseInsensitive) with query (string), globs (array of file globs), and regex (boolean), and remove path since fs_search scans the repository root; smallest change is editing README only; scope documentation; low risk and independent; DoD includes the updated example running successfully on a clean clone (producing expected matches), tests and lint unchanged and green with no coverage regression, all quality gates green; verify by running the example exactly as shown; rollback by reverting the README edit.
* [ ] Add Windows ripgrep install snippet to README Developer prerequisites (Chocolatey: choco install ripgrep -y) because README currently lists apt/brew only and local Windows developers hit ensure-rg unsupported OS; smallest change is adding a Windows bullet; scope documentation only; low risk and independent; DoD includes README rendering with the new Windows example, local Windows setup succeeds (rg --version prints) and make lint/test remain green with no coverage regression, all quality gates green; verify by following the snippet on a Windows dev machine; rollback by reverting the README edit.

## New features for deep research

* [ ] **Create standalone microservice: `searxng_search`** — Implement `cmd/searxng_search` (Go 1.22) HTTP server exposing `POST /tools/searxng/search` with JSON body `{q:string, time_range?: "day"|"week"|"month"|"year", categories?:string[], engines?:string[], language?:string, page?:int, size?:int}` and response `{results:[{title,url,snippet,engine,published_at?}], query, searxng_url}`; read `SEARXNG_BASE_URL` from env; validate URL scheme (http/https), build `?format=json` requests, 10s timeout; reject local/loopback/link-local IPs; unit tests with `httptest` + golden fixture JSON (no live calls); add `docs/openapi/searxng_search.yaml`; README with curl example; **DoD:** `go test ./...` green, `go build ./cmd/searxng_search` succeeds, example curl returns filtered fixture data.
* [ ] **Create standalone microservice: `http_fetch`** — Implement `cmd/http_fetch` with `POST /tools/http/fetch` accepting `{url:string, method?: "GET"|"HEAD", max_bytes?:int=1048576, timeout_ms?:int=10000, decompress?:bool=true}`; allow only `http`/`https`; block SSRF targets (loopback, RFC1918/4193, link-local, unix schemes), follow up to 5 redirects preserving caps, enforce byte cap while streaming; set `User-Agent: goagent-http-fetch/0.1`; return `{status:int, headers:map, body_base64?:string, truncated:bool}`; **DoD:** unit tests cover SSRF block, cap truncation, redirect, gzip; build OK; README + curl.
* [ ] **Create standalone microservice: `robots_txt_check`** — `cmd/robots_txt_check` with `POST /tools/robots/check` body `{url:string, user_agent?:string="goagent"}`; fetch `robots.txt` for origin (reuse internal fetch with 5s timeout), parse REP (Disallow/Allow precedence for UA match-specific then `*`), compute allow boolean for the given `url`; response `{allowed:bool, applicable_group:string[], crawl_delay_ms?:int|null}`; **DoD:** parser unit tests with small embedded robots.txt cases; build OK; README + curl.
* [ ] **Create standalone microservice: `readability_extract`** — `cmd/readability_extract` `POST /tools/parse/readability` body `{html:string, base_url:string}`; use `github.com/go-shiori/go-readability` to extract title, byline, content text, and main HTML; return `{title, byline?, text, content_html, length:int}`; reject if `html` > 5MB; **DoD:** unit tests with fixture HTML (article vs. nav-heavy page), build OK, README + curl.
* [ ] **Create standalone microservice: `metadata_extract`** — `cmd/metadata_extract` `POST /tools/parse/metadata` body `{html:string, base_url:string}`; parse OpenGraph, Twitter Cards, and JSON-LD (Schema.org Article/WebPage if present); return `{opengraph:map, twitter:map, jsonld:any[]}`; **DoD:** tests with fixture pages covering all three; build OK; README + curl.
* [ ] **Create standalone microservice: `pdf_extract`** — `cmd/pdf_extract` `POST /tools/parse/pdf` body `{pdf_base64:string, pages?:int[]}`; use `github.com/ledongthuc/pdf` to extract text (per page), return `{pages:[{index:int, text:string}], page_count:int}`; 20MB size cap; **DoD:** tests with small embedded PDF fixture, build OK, README + curl.
* [ ] **Create standalone microservice: `rss_fetch`** — `cmd/rss_fetch` `POST /tools/feeds/fetch` body `{url:string, if_modified_since?:string}`; fetch with conditional headers, auto-detect RSS/Atom, parse to `{items:[{title,url,published_at?,summary?}], feed:{title,link}}`; **DoD:** tests with fixture feeds (RSS+Atom), build OK, README + curl.
* [ ] **Create standalone microservice: `wayback_lookup`** — `cmd/wayback_lookup` `POST /tools/archives/wayback` body `{url:string, save?:bool=false}`; call Wayback `available` endpoint and optionally `save`; return `{closest_url?:string, timestamp?:string, saved?:bool}`; **DoD:** tests using recorded JSON fixtures, build OK, README + curl.
* [ ] **Create standalone microservice: `wiki_query`** — `cmd/wiki_query` `POST /tools/wiki/query` with `{titles?:string, search?:string, language?:string="en"}`; call MediaWiki Action API `extracts` or `opensearch` depending on payload; return `{pages:[{title,url,extract}]} `; **DoD:** tests with fixtures, build OK, README + curl.
* [ ] **Create standalone microservice: `openalex_search`** — `cmd/openalex_search` `POST /tools/openalex/search` body `{q:string, from?:string, to?:string, per_page?:int=10}`; query `https://api.openalex.org/works` (no key); map to `{results:[{title,doi?,publication_year,open_access_url?,authorships:[],cited_by_count}], next_cursor?}`; **DoD:** fixture tests, build OK, README + curl.
* [ ] **Create standalone microservice: `crossref_search`** — `cmd/crossref_search` `POST /tools/crossref/search` body `{q:string, rows?:int=10}`; call Crossref `/works`, return `{results:[{title,doi,issued,container,title_short?}...]}`; include polite `mailto` header via `CROSSREF_MAILTO`; **DoD:** fixture tests, build OK, README + curl.
* [ ] **Create standalone microservice: `github_search`** — `cmd/github_search` `POST /tools/github/search` body `{q:string, type:"repositories"|"code"|"issues"|"commits", per_page?:int=10}`; use GitHub REST Search with optional `GITHUB_TOKEN`; return `{results:[...minimal fields per type...], rate:{remaining,reset}}`; **DoD:** fixture tests (no live), build OK, README + curl.
* [ ] **Create standalone microservice: `dedupe_rank`** — `cmd/dedupe_rank` `POST /tools/quality/dedupe_rank` body `{docs:[{id:string, url?:string, title?:string, text?:string, published_at?:string}]}`; implement near-duplicate detection via MinHash (3-shingles) and TF-IDF scoring; rank by (dedupe group score, recency, title length heuristic), return `{groups:[{representative_id, members:[id], score:float}]}`; **DoD:** deterministic tests on fixtures, build OK, README.
* [ ] **Create standalone microservice: `citation_pack`** — `cmd/citation_pack` `POST /tools/quality/citation_pack` body `{doc:{title?:string,url:string,published_at?:string}, archive?:{wayback?:boolean}}`; normalize to `{title,url,host,accessed_at,archive_url?}`; if `archive.wayback==true`, attempt Wayback (direct HTTP call) with 3s timeout; **DoD:** tests with fixtures (with/without archive), build OK, README.
* [ ] **Ship common JSON Error schema (embedded per service)** — Define identical `Error` `{code:string,message:string,retry_after_ms?:int,source_url?:string}` in each service and ensure non-2xx replies conform; **DoD:** each service returns `application/json` with `Error` on invalid input and has unit test asserting shape.
* [ ] **Provide OpenAPI spec per service** — For each service above, add `docs/openapi/<service>.yaml` with paths, request/response schemas, and examples; **DoD:** `spectral lint` passes locally; README shows how to import in Postman.
* [ ] **Add example client for `searxng_search` (Go)** — `examples/go/searxng_client/main.go` using typed request/response structs; **DoD:** builds and can read sample output against local fixture server run.
* [ ] **Add example client for `http_fetch` (Go)** — `examples/go/http_fetch_client/main.go`; **DoD:** builds and prints status + length from a provided URL (when server is running).
* [ ] **Package `netsec` allowlist/denylist utility (library)** — `pkg/netsec` with `IsPublicHTTPHost(url) bool` that resolves DNS/A/AAAA and rejects loopback, RFC1918, link-local; **DoD:** unit tests with table of IP/CNAME cases; consumers: `http_fetch` (optional).
* [ ] **Implement deterministic, recorded HTTP fixtures helper** — `pkg/httprecorder` providing round-tripper that replays JSON fixtures keyed by request; **DoD:** used by at least two services’ tests; README snippet.
* [ ] **Add `curl` scripts for each service** — `scripts/curl/<service>.sh` sending a minimal valid request and pretty-printing JSON via `jq`; **DoD:** each script runs against its server and prints example output.
* [ ] **Create minimal Dockerfile per service** — Multi-stage: `FROM golang:1.22` build → `FROM gcr.io/distroless/base-debian12` run; expose `PORT` env (default 8080); **DoD:** `docker build` + `docker run -p 8080:8080` works; health-check via `GET /healthz`.
* [ ] **Add health & readiness endpoints per service** — `GET /healthz` returns 200; `GET /readyz` performs a fast self-check (e.g., env present); **DoD:** tests + README.
* [ ] **Implement per-service rate limiting (in-memory)** — Token bucket per remote host or per endpoint (config via env `RATE_QPS`, `RATE_BURST`); applied to outbound calls (e.g., SearXNG, GitHub, Crossref); **DoD:** unit tests prove limiter gates; README notes limits.
* [ ] **Implement per-service request tracing** — Add W3C Trace-Context extraction/propagation; log `trace_id` in structured logs (JSON); **DoD:** unit test validates header round-trip; README.
* [ ] **Structured logging baseline per service** — Stdout JSON logs with fields `ts, level, service, route, status, dur_ms, trace_id`; `LOG_LEVEL` env; **DoD:** manual run prints expected fields; unit test for logger config.
* [ ] **Config validation per service** — On startup, validate required envs (e.g., `SEARXNG_BASE_URL` for `searxng_search`); exit non-zero with clear error; **DoD:** test covers missing/invalid values.
* [ ] **HTTP server hardening per service** — Disable HTTP/2 cleartext, set read/write timeouts, limit request body size (1MB), add `X-Content-Type-Options: nosniff`; **DoD:** integration test asserts limits and headers.
* [ ] **Add `metadata_extract` + `readability_extract` integration example** — `examples/pipeline/extract_main_content.sh` pipes `http_fetch` → `readability_extract` → `metadata_extract`; **DoD:** script runs and prints title + OG data using a sample page.
* [ ] **Add `rss_fetch` + `http_fetch` integration example** — `examples/pipeline/rss_to_fetch.sh` gets first item URL from feed then fetches; **DoD:** script works with a public sample feed.
* [ ] **Implement `pdf_extract` OCR fallback (optional, independent)** — If `ENABLE_OCR=true`, use `tesseract` via CLI for image-only PDFs; if not installed, return clear `Error.code="OCR_UNAVAILABLE"`; **DoD:** unit test stubs command call; README documents opt-in.
* [ ] **Add per-service CI-like local `make` targets** — `make test`, `make build`, `make run`, `make docker` in each service directory; **DoD:** all targets work locally without network (tests use fixtures).
* [ ] **Provide sample SearXNG response fixtures** — `testdata/searxng/sample.json` with 3–5 varied results; **DoD:** referenced by `searxng_search` tests.
* [ ] **Add input schema validation layer per service** — Use `github.com/go-playground/validator/v10`; return `Error{code:"INVALID_ARGUMENT"}` with field errors; **DoD:** unit test shows invalid cases.
* [ ] **Implement `content_cache` microservice** — `cmd/content_cache` with `POST /cache/get` `{key:string}` → `{hit:bool,value_base64?}` and `POST /cache/set` `{key:string,value_base64:string,ttl_ms:int}`; in-memory map with eviction; **DoD:** unit tests; README; build OK
* [ ] **Implement `rate_limit` microservice** — `cmd/rate_limit` with `POST /bucket/take` `{bucket:string,tokens:int=1,rate_per_sec:float,burst:int}` → `{granted:bool, retry_after_ms?:int}`; in-memory buckets keyed by name; **DoD:** unit tests show gating; README; build OK.
* [ ] **Create `searxng_search` Docker Compose example** — `examples/compose/searxng_search/docker-compose.yaml` runs the service + a SearXNG container with JSON enabled; **DoD:** `docker compose up` exposes both; curl example works.
* [ ] **Add security tests for URL parser in `http_fetch`** — Fuzz test for scheme confusion (`http://127.1`, `http://[::1]`, mixed-encoded hosts), DNS rebinding simulation; **DoD:** `go test -fuzz=...` passes.
* [ ] **Implement simple domain authority hints for `dedupe_rank`** — Static map (e.g., `wikipedia.org`, major news) to bias ranks; config via `AUTHORITY_HINTS_JSON`; **DoD:** unit test verifies tie-break.
* [ ] **Create `citation_pack` + `wayback_lookup` combined example** — `examples/pipeline/cite_and_archive.sh`; **DoD:** prints normalized citation and archive URL using fixtures.
* [ ] **Ship per-service LICENSE/NOTICE and dependency SBOM** — Use `go version -m` + `cyclonedx-gomod` to produce `sbom.json`; **DoD:** SBOM generated and committed under each service.
* [ ] **Add per-service rate/timeout docs** — Document default timeouts, limits, and backoff policy in each README; **DoD:** reviewed and consistent.
* [ ] **Create `wiki_query` language fallback logic** — If `language` not available, retry with `en`; **DoD:** test simulates 404/lang-miss fixture; documented.
* [ ] **Add `github_search` unauthenticated quota handling** — Inspect `X-RateLimit-Remaining`; if zero, return `Error{code:"RATE_LIMITED",retry_after_ms}`; **DoD:** fixture test; docs note GITHUB\_TOKEN usage.
* [ ] **Add JSON examples to all OpenAPI specs** — Include `example` blocks for requests/responses; **DoD:** Spectral passes; examples render in Swagger UI.
* [ ] **Create `wayback_lookup` timeout and retry with jitter** — 1 try + 1 backoff (200–400ms) on 5xx; **DoD:** unit test uses fake server returning 500 then 200.
* [ ] **Add `rss_fetch` ETag/Last-Modified support** — Persist last values in-memory keyed by URL for process lifetime; **DoD:** test simulates 304 Not Modified.
* [ ] **Implement `searxng_search` safe query builder** — Escape site/domain filters and exact phrases; cap `size` to ≤50; **DoD:** unit tests for edge queries.
* [ ] **Create “all-in-one dev runner”** — `cmd/devmux` that can mount any one service at a time via `-service=name`; no cross-service logic; **DoD:** `go run cmd/devmux -service=searxng_search` serves that handler; README lists names.
* [ ] **Add `CHANGELOG.md` entries per service** — Template Keep a Changelog format; **DoD:** v0.1.0 section added for each.
* [ ] **Provide operational runbooks per service** — `docs/runbooks/<service>.md` with startup, envs, ports, troubleshooting, rate-limit/timeout guidance, and example alerts; **DoD:** committed docs.
* [ ] **Create integration test (offline) for sample research flow** — In `examples/tests/research_flow_test.go`, wire fixtures to simulate: searx → http\_fetch → readability → citation\_pack; **DoD:** runs without network using `httprecorder`.
* [ ] **Add accessibility note for content tools** — Ensure `readability_extract` preserves `alt` where possible; **DoD:** unit test on fixture asserts alt retention in `content_html`.
* [ ] **Publish `Makefile` and `.golangci.yml` per service** — Lint (govet,golangci-lint), fmt, test; **DoD:** `make lint` and `make test` green locally.
* [ ] **Document security posture** — `docs/SECURITY.md` describing SSRF protections, IP block list, header sanitation, output caps; **DoD:** file present and referenced from each README.
* [ ] **Add versioning & semver** — Each service prints `-version` and embeds `main.version` via `-ldflags`; **DoD:** `./service -version` prints v0.1.0.
* [ ] **Create per-service sample systemd unit** — `deploy/systemd/<service>.service` with `EnvironmentFile=/etc/default/<service>`; **DoD:** `systemd-analyze verify` passes locally.
* [ ] **Provide Postman/Insomnia collection** — `docs/collections/research-tools.json` containing all endpoints with examples; **DoD:** can be imported and run against local servers with fixtures.
* [ ] **Add error examples to READMEs** — Show `INVALID_ARGUMENT`, `RATE_LIMITED`, `FETCH_BLOCKED` (SSRF) cases; **DoD:** present and accurate.
* [ ] **Create minimal license notice for fixtures** — `testdata/NOTICE.md` clarifying synthetic data; **DoD:** committed.
* [ ] **Add `CONTRIBUTING.md` for services** — Style, testing, fixtures policy, DCO sign-off; **DoD:** present.
* [ ] **Ship sample env files** — `.env.example` per service with documented envs; **DoD:** included and referenced in README.
* [ ] **Add port configurability** — Each service reads `PORT` env (default 8080) and logs bind address; **DoD:** verified by starting on non-default port.
* [ ] **Return CORS headers** — Allow `POST` from `*` for tool endpoints with `Access-Control-Allow-Origin: *` (configurable); **DoD:** integration test asserts headers.
* [ ] **Create smoke test scripts** — `scripts/smoke/<service>.sh` start server, hit `/healthz`, then one valid request; **DoD:** scripts run locally without network (fixtures).
* [ ] **Add graceful shutdown** — Handle SIGTERM with 10s timeout; **DoD:** test uses context cancel and verifies server exit.
* [ ] **Embed build info in logs** — On startup log `version`, `commit`, `build_date`; set via `-ldflags`; **DoD:** visible in stdout.
* [ ] **Add JSON Schema files** — `docs/schema/<service>-request.json` and `<service>-response.json`; **DoD:** `ajv` validation examples provided in README.
* [ ] **Publish Mermaid high-level diagram** — `docs/diagrams/research-tools.md` contains Mermaid graph of independent services; **DoD:** renders on GitHub.
* [ ] **Create license-compliant third-party notices** — `docs/THIRD_PARTY_LICENSES.md` listing libraries used per service; **DoD:** present.
* [ ] **Add reproducible builds** — `goreleaser` config per service to produce pinned, checksumed binaries to `dist/`; **DoD:** `goreleaser release --snapshot` works locally.

